#define N_POLES 2
#define V_S_FALLBACK 400

// 1024 values of sin ranging between -32768 and 32767
int fastsin[] = {
0, 20, 39, 58, 77, 97, 117, 135, 155, 174, 194, 212, 232, 252, 270, 290, 309, 329, 348, 367, 387, 405, 425, 445, 463, 483, 502, 521, 540, 560, 579, 598, 618, 636, 656, 674, 694, 714, 732, 752, 770, 790, 808, 828, 846, 866, 885, 904, 923, 942, 961, 979, 999, 1017, 1036, 1055, 1074, 1092, 1112, 1130, 1149, 1167, 1187, 1206, 1224, 1242, 1261, 1281, 1299, 1318, 1336, 1354, 1373, 1391, 1410, 1428, 1447, 1465, 1484, 1502, 1521, 1538, 1557, 1575, 1593, 1612, 1629, 1648, 1666, 1684, 1702, 1721, 1738, 1756, 1774, 1792, 1809, 1828, 1845, 1864, 1881, 1899, 1917, 1934, 1951, 1970, 1987, 2005, 2022, 2039, 2057, 2075, 2092, 2110, 2127, 2144, 2160, 2178, 2195, 2212, 2230, 2247, 2263, 2281, 2298, 2314, 2331, 2348, 2365, 2381, 2398, 2414, 2432, 2448, 2464, 2481, 2498, 2514, 2530, 2546, 2563, 2580, 2596, 2612, 2628, 2644, 2659, 2675, 2692, 2708, 2724, 2739, 2755, 2770, 2786, 2802, 2817, 2832, 2849, 2864, 2879, 2895, 2910, 2925, 2940, 2955, 2970, 2986, 3000, 3015, 3030, 3045, 3060, 3075, 3089, 3104, 3119, 3133, 3148, 3162, 3177, 3190, 3204, 3219, 3233, 3247, 3261, 3275, 3290, 3304, 3317, 3330, 3344, 3358, 3372, 3386, 3398, 3412, 3426, 3439, 3453, 3465, 3478, 3492, 3505, 3517, 3530, 3543, 3556, 3569, 3582, 3593, 3606, 3619, 3632, 3644, 3656, 3668, 3680, 3693, 3704, 3717, 3729, 3740, 3753, 3764, 3776, 3787, 3799, 3811, 3822, 3834, 3844, 3856, 3867, 3877, 3889, 3901, 3911, 3921, 3933, 3943, 3954, 3964, 3974, 3986, 3996, 4006, 4016, 4026, 4037, 4047, 4056, 4067, 4076, 4086, 4096, 4106, 4115, 4125, 4134, 4143, 4152, 4162, 4171, 4180, 4189, 4198, 4207, 4216, 4225, 4233, 4242, 4250, 4259, 4268, 4276, 4284, 4292, 4300, 4308, 4316, 4324, 4331, 4339, 4347, 4354, 4362, 4369, 4377, 4384, 4391, 4398, 4405, 4413, 4420, 4426, 4433, 4440, 4447, 4454, 4459, 4466, 4472, 4479, 4485, 4491, 4496, 4503, 4509, 4515, 4521, 4526, 4531, 4537, 4543, 4548, 4553, 4559, 4563, 4568, 4574, 4578, 4583, 4588, 4592, 4597, 4601, 4606, 4611, 4614, 4619, 4623, 4627, 4632, 4635, 4638, 4643, 4647, 4650, 4653, 4657, 4660, 4664, 4666, 4670, 4673, 4675, 4679, 4681, 4683, 4687, 4689, 4692, 4694, 4696, 4698, 4701, 4703, 4705, 4707, 4709, 4710, 4712, 4713, 4716, 4717, 4718, 4719, 4720, 4722, 4723, 4724, 4725, 4726, 4726, 4727, 4727, 4728, 4728, 4728, 4730, 4730, 4730, 4730, 4730, 4730, 4730, 4728, 4728, 4728, 4727, 4727, 4726, 4726, 4725, 4724, 4723, 4722, 4720, 4719, 4718, 4717, 4716, 4713, 4712, 4710, 4709, 4707, 4705, 4703, 4701, 4698, 4696, 4694, 4692, 4689, 4687, 4683, 4681, 4679, 4675, 4673, 4670, 4666, 4664, 4660, 4657, 4653, 4650, 4647, 4643, 4638, 4635, 4632, 4627, 4623, 4619, 4614, 4611, 4606, 4601, 4597, 4592, 4588, 4583, 4578, 4574, 4568, 4563, 4559, 4553, 4548, 4543, 4537, 4531, 4526, 4521, 4515, 4509, 4503, 4496, 4491, 4485, 4479, 4472, 4466, 4459, 4454, 4447, 4440, 4433, 4426, 4420, 4413, 4405, 4398, 4391, 4384, 4377, 4369, 4362, 4354, 4347, 4339, 4331, 4324, 4316, 4308, 4300, 4292, 4284, 4276, 4268, 4259, 4250, 4242, 4233, 4225, 4216, 4207, 4198, 4189, 4180, 4171, 4162, 4152, 4143, 4134, 4125, 4115, 4106, 4096, 4086, 4076, 4067, 4056, 4047, 4037, 4026, 4016, 4006, 3996, 3986, 3974, 3964, 3954, 3943, 3933, 3921, 3911, 3901, 3889, 3877, 3867, 3856, 3844, 3834, 3822, 3811, 3799, 3787, 3776, 3764, 3753, 3740, 3729, 3717, 3704, 3693, 3680, 3668, 3656, 3644, 3632, 3619, 3606, 3593, 3582, 3569, 3556, 3543, 3530, 3517, 3505, 3492, 3478, 3465, 3453, 3439, 3426, 3412, 3398, 3386, 3372, 3358, 3344, 3330, 3317, 3304, 3290, 3275, 3261, 3247, 3233, 3219, 3204, 3190, 3177, 3162, 3148, 3133, 3119, 3104, 3089, 3075, 3060, 3045, 3030, 3015, 3000, 2986, 2970, 2955, 2940, 2925, 2910, 2895, 2879, 2864, 2849, 2832, 2817, 2802, 2786, 2770, 2755, 2739, 2724, 2708, 2692, 2675, 2659, 2644, 2628, 2612, 2596, 2580, 2563, 2546, 2530, 2514, 2498, 2481, 2464, 2448, 2432, 2414, 2398, 2381, 2365, 2348, 2331, 2314, 2298, 2281, 2263, 2247, 2230, 2212, 2195, 2178, 2160, 2144, 2127, 2110, 2092, 2075, 2057, 2039, 2022, 2005, 1987, 1970, 1951, 1934, 1917, 1899, 1881, 1864, 1845, 1828, 1809, 1792, 1774, 1756, 1738, 1721, 1702, 1684, 1666, 1648, 1629, 1612, 1593, 1575, 1557, 1538, 1521, 1502, 1484, 1465, 1447, 1428, 1410, 1391, 1373, 1354, 1336, 1318, 1299, 1281, 1261, 1242, 1224, 1206, 1187, 1167, 1149, 1130, 1112, 1092, 1074, 1055, 1036, 1017, 999, 979, 961, 942, 923, 904, 885, 866, 846, 828, 808, 790, 770, 752, 732, 714, 694, 674, 656, 636, 618, 598, 579, 560, 540, 521, 502, 483, 463, 445, 425, 405, 387, 367, 348, 329, 309, 290, 270, 252, 232, 212, 194, 174, 155, 135, 117, 97, 77, 58, 39, 20, 0, -20, -39, -58, -77, -97, -117, -135, -155, -174, -194, -212, -232, -252, -270, -290, -309, -329, -348, -367, -387, -405, -425, -445, -463, -483, -502, -521, -540, -560, -579, -598, -618, -636, -656, -674, -694, -714, -732, -752, -770, -790, -808, -828, -846, -866, -885, -904, -923, -942, -961, -979, -999, -1017, -1036, -1055, -1074, -1092, -1112, -1130, -1149, -1167, -1187, -1206, -1224, -1242, -1261, -1281, -1299, -1318, -1336, -1354, -1373, -1391, -1410, -1428, -1447, -1465, -1484, -1502, -1521, -1538, -1557, -1575, -1593, -1612, -1629, -1648, -1666, -1684, -1702, -1721, -1738, -1756, -1774, -1792, -1809, -1828, -1845, -1864, -1881, -1899, -1917, -1934, -1951, -1970, -1987, -2005, -2022, -2039, -2057, -2075, -2092, -2110, -2127, -2144, -2160, -2178, -2195, -2212, -2230, -2247, -2263, -2281, -2298, -2314, -2331, -2348, -2365, -2381, -2398, -2414, -2432, -2448, -2464, -2481, -2498, -2514, -2530, -2546, -2563, -2580, -2596, -2612, -2628, -2644, -2659, -2675, -2692, -2708, -2724, -2739, -2755, -2770, -2786, -2802, -2817, -2832, -2849, -2864, -2879, -2895, -2910, -2925, -2940, -2955, -2970, -2986, -3000, -3015, -3030, -3045, -3060, -3075, -3089, -3104, -3119, -3133, -3148, -3162, -3177, -3190, -3204, -3219, -3233, -3247, -3261, -3275, -3290, -3304, -3317, -3330, -3344, -3358, -3372, -3386, -3398, -3412, -3426, -3439, -3453, -3465, -3478, -3492, -3505, -3517, -3530, -3543, -3556, -3569, -3582, -3593, -3606, -3619, -3632, -3644, -3656, -3668, -3680, -3693, -3704, -3717, -3729, -3740, -3753, -3764, -3776, -3787, -3799, -3811, -3822, -3834, -3844, -3856, -3867, -3877, -3889, -3901, -3911, -3921, -3933, -3943, -3954, -3964, -3974, -3986, -3996, -4006, -4016, -4026, -4037, -4047, -4056, -4067, -4076, -4086, -4096, -4106, -4115, -4125, -4134, -4143, -4152, -4162, -4171, -4180, -4189, -4198, -4207, -4216, -4225, -4233, -4242, -4250, -4259, -4268, -4276, -4284, -4292, -4300, -4308, -4316, -4324, -4331, -4339, -4347, -4354, -4362, -4369, -4377, -4384, -4391, -4398, -4405, -4413, -4420, -4426, -4433, -4440, -4447, -4454, -4459, -4466, -4472, -4479, -4485, -4491, -4496, -4503, -4509, -4515, -4521, -4526, -4531, -4537, -4543, -4548, -4553, -4559, -4563, -4568, -4574, -4578, -4583, -4588, -4592, -4597, -4601, -4606, -4611, -4614, -4619, -4623, -4627, -4632, -4635, -4638, -4643, -4647, -4650, -4653, -4657, -4660, -4664, -4666, -4670, -4673, -4675, -4679, -4681, -4683, -4687, -4689, -4692, -4694, -4696, -4698, -4701, -4703, -4705, -4707, -4709, -4710, -4712, -4713, -4716, -4717, -4718, -4719, -4720, -4722, -4723, -4724, -4725, -4726, -4726, -4727, -4727, -4728, -4728, -4728, -4730, -4730, -4730, -4730, -4730, -4730, -4730, -4728, -4728, -4728, -4727, -4727, -4726, -4726, -4725, -4724, -4723, -4722, -4720, -4719, -4718, -4717, -4716, -4713, -4712, -4710, -4709, -4707, -4705, -4703, -4701, -4698, -4696, -4694, -4692, -4689, -4687, -4683, -4681, -4679, -4675, -4673, -4670, -4666, -4664, -4660, -4657, -4653, -4650, -4647, -4643, -4638, -4635, -4632, -4627, -4623, -4619, -4614, -4611, -4606, -4601, -4597, -4592, -4588, -4583, -4578, -4574, -4568, -4563, -4559, -4553, -4548, -4543, -4537, -4531, -4526, -4521, -4515, -4509, -4503, -4496, -4491, -4485, -4479, -4472, -4466, -4459, -4454, -4447, -4440, -4433, -4426, -4420, -4413, -4405, -4398, -4391, -4384, -4377, -4369, -4362, -4354, -4347, -4339, -4331, -4324, -4316, -4308, -4300, -4292, -4284, -4276, -4268, -4259, -4250, -4242, -4233, -4225, -4216, -4207, -4198, -4189, -4180, -4171, -4162, -4152, -4143, -4134, -4125, -4115, -4106, -4096, -4086, -4076, -4067, -4056, -4047, -4037, -4026, -4016, -4006, -3996, -3986, -3974, -3964, -3954, -3943, -3933, -3921, -3911, -3901, -3889, -3877, -3867, -3856, -3844, -3834, -3822, -3811, -3799, -3787, -3776, -3764, -3753, -3740, -3729, -3717, -3704, -3693, -3680, -3668, -3656, -3644, -3632, -3619, -3606, -3593, -3582, -3569, -3556, -3543, -3530, -3517, -3505, -3492, -3478, -3465, -3453, -3439, -3426, -3412, -3398, -3386, -3372, -3358, -3344, -3330, -3317, -3304, -3290, -3275, -3261, -3247, -3233, -3219, -3204, -3190, -3177, -3162, -3148, -3133, -3119, -3104, -3089, -3075, -3060, -3045, -3030, -3015, -3000, -2986, -2970, -2955, -2940, -2925, -2910, -2895, -2879, -2864, -2849, -2832, -2817, -2802, -2786, -2770, -2755, -2739, -2724, -2708, -2692, -2675, -2659, -2644, -2628, -2612, -2596, -2580, -2563, -2546, -2530, -2514, -2498, -2481, -2464, -2448, -2432, -2414, -2398, -2381, -2365, -2348, -2331, -2314, -2298, -2281, -2263, -2247, -2230, -2212, -2195, -2178, -2160, -2144, -2127, -2110, -2092, -2075, -2057, -2039, -2022, -2005, -1987, -1970, -1951, -1934, -1917, -1899, -1881, -1864, -1845, -1828, -1809, -1792, -1774, -1756, -1738, -1721, -1702, -1684, -1666, -1648, -1629, -1612, -1593, -1575, -1557, -1538, -1521, -1502, -1484, -1465, -1447, -1428, -1410, -1391, -1373, -1354, -1336, -1318, -1299, -1281, -1261, -1242, -1224, -1206, -1187, -1167, -1149, -1130, -1112, -1092, -1074, -1055, -1036, -1017, -999, -979, -961, -942, -923, -904, -885, -866, -846, -828, -808, -790, -770, -752, -732, -714, -694, -674, -656, -636, -618, -598, -579, -560, -540, -521, -502, -483, -463, -445, -425, -405, -387, -367, -348, -329, -309, -290, -270, -252, -232, -212, -194, -174, -155, -135, -117, -97, -77, -58, -39, -20, 0
};
